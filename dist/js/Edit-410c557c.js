var h=(U,p,c)=>new Promise((v,g)=>{var V=i=>{try{f(c.next(i))}catch(_){g(_)}},t=i=>{try{f(c.throw(i))}catch(_){g(_)}},f=i=>i.done?v(i.value):Promise.resolve(i.value).then(V,t);f((c=c.apply(U,p)).next())});import{d as T,r as k,a as M,k as K,l as Y,c as O,g as x,b as e,w as l,T as j,G as z,e as G,x as P,E as F,f as s,z as $,o as A,h as y,B as H,q as J,i as L,_ as Q}from"./index-0d744b35.js";import{f as q}from"./date-70ed563a.js";import{T as W}from"./TaxInvoiceUpload-5376d54e.js";import{R as D}from"./index-468e0e38.js";import{u as X}from"./options-9fb748fa.js";const Z={class:"inbound-edit"},ee={class:"page-header"},te={class:"form-actions"},oe=T({__name:"Edit",setup(U){const p=z(),c=G(),v=X(),g=k(!1),V=k(),t=M({inboundDate:q(new Date),inboundNo:"",supplier:"",productSpec:"",composition:"",weight:null,width:null,color:"",colorNo:"",batchNo:"",quantity:null,weightKg:null,unitPrice:null,amount:null,operator:"admin",taxAttachments:[]}),f={inboundDate:[{required:!0,message:"请选择入库日期",trigger:"change"}],inboundNo:[{required:!0,message:"请输入货单编号",trigger:"blur"}],supplier:[{required:!0,message:"请输入供应商",trigger:"blur"}],productSpec:[{required:!0,message:"请输入品名规格",trigger:"blur"}],composition:[{required:!0,message:"请输入成分",trigger:"blur"}],weight:[{required:!0,message:"请输入克重",trigger:"blur"}],width:[{required:!0,message:"请输入全幅宽",trigger:"blur"}],color:[{required:!0,message:"请输入颜色",trigger:"blur"}],colorNo:[{required:!0,message:"请输入色号",trigger:"blur"}],batchNo:[{required:!0,message:"请输入缸号",trigger:"blur"}],quantity:[{required:!0,message:"请输入匹数",trigger:"blur"}],weightKg:[{required:!0,message:"请输入重量",trigger:"blur"}],unitPrice:[{required:!0,message:"请输入单价",trigger:"blur"}]},i=K(()=>(Number(t.weightKg||0)*Number(t.unitPrice||0)).toFixed(2)),_=K(()=>`draft:inbound:edit:${p.params.id}`),B=()=>h(this,null,function*(){var w,o,b,N,u,n,m;try{g.value=!0;const d=p.params.id||p.query.id;if(!d)throw new Error("ID无效");const r=yield P.getInboundDetail(d);Object.assign(t,{inboundDate:r.inboundDate?q(r.inboundDate):q(new Date),inboundNo:r.inboundNo,supplier:r.supplier,productSpec:(w=r.colorFabric)==null?void 0:w.productSpec,composition:(o=r.colorFabric)==null?void 0:o.composition,weight:Number((b=r.colorFabric)==null?void 0:b.weight),width:Number((N=r.colorFabric)==null?void 0:N.width),color:(u=r.colorFabric)==null?void 0:u.color,colorNo:(n=r.colorFabric)==null?void 0:n.colorNo,batchNo:(m=r.colorFabric)==null?void 0:m.batchNo,quantity:Number(r.quantity),weightKg:Number(r.weightKg),unitPrice:Number(r.unitPrice),amount:Number(r.amount),operator:r.operator||"admin",taxAttachments:r.taxAttachments||[]})}catch(d){F.error("加载详情失败")}finally{g.value=!1}}),S=()=>{c.push("/inventory/in")},E=()=>h(this,null,function*(){if(!(yield V.value.validate()))return;const o=p.params.id;t.amount=parseFloat(i.value),yield P.updateInbound(o,{inboundDate:t.inboundDate,inboundNo:t.inboundNo,supplier:t.supplier,productSpec:t.productSpec,composition:t.composition,weight:t.weight,width:t.width,color:t.color,colorNo:t.colorNo,batchNo:t.batchNo,quantity:t.quantity,weightKg:t.weightKg,unitPrice:t.unitPrice,amount:i.value,operator:"admin"}),localStorage.removeItem(_.value),F.success("保存成功"),v.invalidate(),c.push("/inventory/in")});return Y(()=>{B()}),(w,o)=>{const b=s("el-button"),N=s("el-date-picker"),u=s("el-form-item"),n=s("el-col"),m=s("el-input"),d=s("el-row"),r=s("el-input-number"),I=s("el-form"),C=s("el-card"),R=$("loading");return A(),O("div",Z,[x("div",ee,[e(b,{class:"back-btn",onClick:S},{default:l(()=>[...o[15]||(o[15]=[y("返回",-1)])]),_:1}),o[16]||(o[16]=x("h1",{class:"page-title"},"编辑入库",-1))]),e(j,{name:"fade"},{default:l(()=>[H((A(),J(C,null,{default:l(()=>[e(I,{model:t,rules:f,ref_key:"formRef",ref:V,"label-width":"100px"},{default:l(()=>[e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"入库日期",prop:"inboundDate"},{default:l(()=>[e(N,{modelValue:t.inboundDate,"onUpdate:modelValue":o[0]||(o[0]=a=>t.inboundDate=a),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"货单编号",prop:"inboundNo"},{default:l(()=>[e(m,{modelValue:t.inboundNo,"onUpdate:modelValue":o[1]||(o[1]=a=>t.inboundNo=a),placeholder:"请输入货单编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"供应商",prop:"supplier"},{default:l(()=>[e(D,{modelValue:t.supplier,"onUpdate:modelValue":o[2]||(o[2]=a=>t.supplier=a),type:"supplier","allow-create":!0,placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"品名规格",prop:"productSpec"},{default:l(()=>[e(D,{modelValue:t.productSpec,"onUpdate:modelValue":o[3]||(o[3]=a=>t.productSpec=a),type:"productSpec","allow-create":!0,placeholder:"请输入品名规格"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"成分",prop:"composition"},{default:l(()=>[e(D,{modelValue:t.composition,"onUpdate:modelValue":o[4]||(o[4]=a=>t.composition=a),type:"composition","allow-create":!0,placeholder:"如: 95%棉5%氨纶"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"克重(g/m²)",prop:"weight"},{default:l(()=>[e(r,{modelValue:t.weight,"onUpdate:modelValue":o[5]||(o[5]=a=>t.weight=a),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"全幅宽(cm)",prop:"width"},{default:l(()=>[e(r,{modelValue:t.width,"onUpdate:modelValue":o[6]||(o[6]=a=>t.width=a),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"颜色",prop:"color"},{default:l(()=>[e(m,{modelValue:t.color,"onUpdate:modelValue":o[7]||(o[7]=a=>t.color=a),placeholder:"请输入颜色"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"色号",prop:"colorNo"},{default:l(()=>[e(m,{modelValue:t.colorNo,"onUpdate:modelValue":o[8]||(o[8]=a=>t.colorNo=a),placeholder:"如: AB123"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"缸号",prop:"batchNo"},{default:l(()=>[e(m,{modelValue:t.batchNo,"onUpdate:modelValue":o[9]||(o[9]=a=>t.batchNo=a),placeholder:"请输入缸号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"匹数",prop:"quantity"},{default:l(()=>[e(r,{modelValue:t.quantity,"onUpdate:modelValue":o[10]||(o[10]=a=>t.quantity=a),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"重量(kg)",prop:"weightKg"},{default:l(()=>[e(r,{modelValue:t.weightKg,"onUpdate:modelValue":o[11]||(o[11]=a=>t.weightKg=a),min:.1,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"单价(元)",prop:"unitPrice"},{default:l(()=>[e(r,{modelValue:t.unitPrice,"onUpdate:modelValue":o[12]||(o[12]=a=>t.unitPrice=a),min:.01,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{xs:24,sm:12},{default:l(()=>[e(u,{label:"金额(元)",prop:"amount"},{default:l(()=>[e(m,{modelValue:i.value,"onUpdate:modelValue":o[13]||(o[13]=a=>i.value=a),readonly:""},{prefix:l(()=>[...o[17]||(o[17]=[y("¥",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{gutter:16},{default:l(()=>[e(n,{xs:24,sm:24},{default:l(()=>[e(u,{label:"附件"},{default:l(()=>[e(W,{"model-value":t.taxAttachments,"record-type":"inbound","record-id":L(p).params.id,"onUpdate:modelValue":o[14]||(o[14]=a=>t.taxAttachments=a)},null,8,["model-value","record-id"])]),_:1})]),_:1})]),_:1}),x("div",te,[e(b,{onClick:S},{default:l(()=>[...o[18]||(o[18]=[y("返回",-1)])]),_:1}),e(b,{type:"primary",onClick:E},{default:l(()=>[...o[19]||(o[19]=[y("保存",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})),[[R,g.value]])]),_:1})])}}});const de=Q(oe,[["__scopeId","data-v-81780aa5"]]);export{de as default};
