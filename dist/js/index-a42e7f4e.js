var V=(s,p,a)=>new Promise((d,l)=>{var o=r=>{try{u(a.next(r))}catch(t){l(t)}},m=r=>{try{u(a.throw(r))}catch(t){l(t)}},u=r=>r.done?d(r.value):Promise.resolve(r.value).then(o,m);u((a=a.apply(s,p)).next())});import{K as B,r as S,x,d as I,k as z,F as L,l as T,f as C,z as E,o as _,q as b,w as D,c as k,I as K,H as N,B as A,h as O,t as Q,v as R,_ as j}from"./index-df9e2be5.js";const H=B("option",()=>{const s=S({list:[],page:1,hasMore:!0,loading:!1,total:0}),p=S({list:[],page:1,hasMore:!0,loading:!1,total:0}),a=S({list:[],page:1,hasMore:!0,loading:!1,total:0}),d=S({list:[],page:1,hasMore:!0,loading:!1,total:0}),l=t=>{switch(t){case"supplier":return s;case"productSpec":return p;case"composition":return a;case"customer":return d}},o=(t,n)=>{var i,e;switch(t){case"supplier":return n.supplier;case"productSpec":return(i=n.colorFabric)==null?void 0:i.productSpec;case"composition":return(e=n.colorFabric)==null?void 0:e.composition;case"customer":return n.customer}},m=t=>{switch(t){case"supplier":return"supplier";case"productSpec":return"productSpec";case"composition":return"composition";case"customer":return"customer"}};return{supplierState:s,productSpecState:p,compositionState:a,customerState:d,loadData:(t,n,i=!1)=>V(void 0,null,function*(){const e=l(t);if(e.value&&!(e.value.loading&&!i)&&(i&&(e.value.page=1,e.value.list=[],e.value.hasMore=!0,e.value.total=0),!(!e.value.hasMore&&!i))){e.value.loading=!0;try{const f={page:e.value.page,pageSize:20},y=m(t);n&&(f[y]=n);let g=x.getInboundList;t==="customer"?g=x.getOutboundList:g=x.getInboundList;const c=yield g(f),v=(c==null?void 0:c.list)||c||[],F=(c==null?void 0:c.total)||0,w=new Set;if(v.forEach(M=>{const h=o(t,M);h&&w.add(h)}),e.value.page===1)e.value.list=Array.from(w);else{const M=new Set(e.value.list);w.forEach(h=>{M.has(h)||e.value.list.push(h)})}e.value.total=F,v.length<f.pageSize?e.value.hasMore=!1:e.value.page++}catch(f){console.error(`Failed to load ${t}`,f)}finally{e.value.loading=!1}}}),invalidate:()=>{s.value={list:[],page:1,hasMore:!0,loading:!1,total:0},p.value={list:[],page:1,hasMore:!0,loading:!1,total:0},a.value={list:[],page:1,hasMore:!0,loading:!1,total:0},d.value={list:[],page:1,hasMore:!0,loading:!1,total:0}}}}),P={style:{width:"100%","text-align":"center",color:"#999","font-size":"12px"}},U=I({__name:"index",props:{modelValue:{},type:{},placeholder:{},allowCreate:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:p}){const a=s,d=p,l=H(),o=z(()=>{switch(a.type){case"supplier":return l.supplierState;case"productSpec":return l.productSpecState;case"composition":return l.compositionState;case"customer":return l.customerState;default:return l.supplierState}}),m=S("");let u=null;const r=e=>{e&&(m.value=e,u&&clearTimeout(u),u=setTimeout(()=>{l.loadData(a.type,e,!0)},500))},t=()=>{m.value="",l.loadData(a.type,"",!0)},n=()=>{!o.value.loading&&o.value.hasMore&&l.loadData(a.type,m.value,!1)},i=e=>{d("update:modelValue",e)};return L(()=>a.modelValue,e=>{e||t()}),T(()=>{o.value.list.length===0&&l.loadData(a.type,"",!1)}),(e,f)=>{const y=C("el-option"),g=C("el-select"),c=E("load-more");return _(),b(g,{"model-value":s.modelValue,"onUpdate:modelValue":i,filterable:"",remote:"","remote-method":r,loading:o.value.loading,clearable:"",placeholder:s.placeholder||"请输入关键词搜索","allow-create":s.allowCreate,"default-first-option":"",onClear:t,style:{width:"100%"}},{default:D(()=>[(_(!0),k(N,null,K(o.value.list,v=>(_(),b(y,{key:v,label:v,value:v},null,8,["label","value"]))),128)),o.value.hasMore?(_(),b(y,{key:0,value:"__loading__",disabled:"",style:{height:"30px",display:"flex","justify-content":"center","align-items":"center"}},{default:D(()=>[A((_(),k("div",P,[O(Q(o.value.loading?"加载中...":"加载更多"),1)])),[[c,n]])]),_:1})):R("",!0)]),_:1},8,["model-value","loading","placeholder","allow-create"])}}});const J=j(U,[["__scopeId","data-v-048cf511"]]);export{J as R,H as u};
