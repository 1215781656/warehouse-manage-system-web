var U=(g,y,s)=>new Promise((f,p)=>{var c=n=>{try{v(s.next(n))}catch(i){p(i)}},l=n=>{try{v(s.throw(n))}catch(i){p(i)}},v=n=>n.done?f(n.value):Promise.resolve(n.value).then(c,l);v((s=s.apply(g,y)).next())});import{d as W,r,k as B,c as T,g as w,b as o,w as t,e as $,f as d,o as E,h as V,M as F,E as N,_ as G}from"./index-df9e2be5.js";import{O as M}from"./OperationBar-90a480f9.js";import{T as O}from"./TaxInvoiceUpload-5d5a3401.js";import{G as j}from"./GeneralFileUpload-45921d0a.js";const q={class:"add-page"},z={class:"page-header"},H=W({__name:"Add",setup(g){const y=$(),s=r(),f=r(),p=r(),c=r(!1),l=r({inboundDate:new Date,inboundNo:"",code:"",supplier:"",productSpec:"",composition:"",color:"",craft:"",fabricWeight:"",customerRemark:"",pieceCount:0,totalWeight:0,unitPrice:0,payableAmount:0,paidAmount:0,taxInvoiceAmount:0,remark:""}),v=r([]),n=r([]),i=r(null),R=B(()=>{const m=Number(l.value.payableAmount||0),e=Number(l.value.paidAmount||0);return(m-e).toFixed(2)}),C=()=>U(this,null,function*(){var m;try{c.value=!0;const e=yield F.createPayable({inboundDate:l.value.inboundDate,inboundNo:l.value.inboundNo,supplier:l.value.supplier,code:l.value.code,productSpec:l.value.productSpec,composition:l.value.composition,color:l.value.color,craft:l.value.craft,fabricWeight:l.value.fabricWeight,customerRemark:l.value.customerRemark,pieceCount:l.value.pieceCount,totalWeight:l.value.totalWeight,unitPrice:l.value.unitPrice,payableAmount:l.value.payableAmount,paidAmount:l.value.paidAmount,taxInvoiceAmount:Number(l.value.taxInvoiceAmount||0),remark:l.value.remark,source:"manual"}),b=(e==null?void 0:e.id)||((m=e==null?void 0:e.data)==null?void 0:m.id);i.value=String(b||""),f.value&&f.value.submit(),p.value&&p.value.submit(),yield new Promise(A=>setTimeout(A,1e3)),N.success("新增成功"),y.back()}catch(e){console.error(e),N.error("保存失败")}finally{c.value=!1}});return(m,e)=>{const b=d("el-button"),A=d("el-date-picker"),u=d("el-form-item"),_=d("el-input"),x=d("el-col"),k=d("el-input-number"),I=d("el-row"),D=d("el-divider"),P=d("el-form"),S=d("el-card");return E(),T("div",q,[w("div",z,[o(b,{onClick:e[0]||(e[0]=a=>m.$router.back())},{default:t(()=>[...e[12]||(e[12]=[V("返回",-1)])]),_:1}),e[13]||(e[13]=w("h3",null,"新增应付",-1))]),o(S,null,{default:t(()=>[o(P,{model:l.value,"label-width":"100px",ref_key:"formRef",ref:s},{default:t(()=>[o(I,{gutter:24},{default:t(()=>[o(x,{span:12},{default:t(()=>[o(u,{label:"入库日期"},{default:t(()=>[o(A,{modelValue:l.value.inboundDate,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.inboundDate=a),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"货单编号"},{default:t(()=>[o(_,{modelValue:l.value.inboundNo,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.inboundNo=a)},null,8,["modelValue"])]),_:1}),o(u,{label:"供应商"},{default:t(()=>[o(_,{modelValue:l.value.supplier,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.supplier=a)},null,8,["modelValue"])]),_:1}),o(u,{label:"品名规格"},{default:t(()=>[o(_,{modelValue:l.value.productSpec,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.productSpec=a)},null,8,["modelValue"])]),_:1})]),_:1}),o(x,{span:12},{default:t(()=>[o(u,{label:"应付金额"},{default:t(()=>[o(k,{modelValue:l.value.payableAmount,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.payableAmount=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"已付金额"},{default:t(()=>[o(k,{modelValue:l.value.paidAmount,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.paidAmount=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"税票金额"},{default:t(()=>[o(k,{modelValue:l.value.taxInvoiceAmount,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.taxInvoiceAmount=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"未付金额"},{default:t(()=>[o(_,{value:R.value,disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(u,{label:"备注"},{default:t(()=>[o(_,{modelValue:l.value.remark,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.remark=a),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),o(D,{"content-position":"left"},{default:t(()=>[...e[14]||(e[14]=[V("附件",-1)])]),_:1}),o(u,{label:"税票附件"},{default:t(()=>[o(O,{ref_key:"taxUploadRef",ref:f,modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=a=>v.value=a),"record-type":"payable","record-id":i.value||"",deferred:""},null,8,["modelValue","record-id"])]),_:1}),o(u,{label:"其他附件"},{default:t(()=>[o(j,{ref_key:"otherUploadRef",ref:p,modelValue:n.value,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value=a),"record-type":"payable","record-id":i.value||"",deferred:""},null,8,["modelValue","record-id"])]),_:1})]),_:1},8,["model"])]),_:1}),o(M,null,{button:t(()=>[o(b,{onClick:e[11]||(e[11]=a=>m.$router.back())},{default:t(()=>[...e[15]||(e[15]=[V("返回",-1)])]),_:1}),o(b,{type:"primary",onClick:C,loading:c.value},{default:t(()=>[...e[16]||(e[16]=[V("保存",-1)])]),_:1},8,["loading"])]),_:1})])}}});const Y=G(H,[["__scopeId","data-v-40521038"]]);export{Y as default};
