var U=(g,A,s)=>new Promise((p,v)=>{var f=n=>{try{c(s.next(n))}catch(i){v(i)}},l=n=>{try{c(s.throw(n))}catch(i){v(i)}},c=n=>n.done?p(n.value):Promise.resolve(n.value).then(f,l);c((s=s.apply(g,A)).next())});import{d as P,r as d,k as B,c as T,g as w,b as o,w as a,e as $,f as r,o as E,h as V,M as F,E as N,_ as G}from"./index-0d744b35.js";import{O as M}from"./OperationBar-ba9dfaef.js";import{T as O}from"./TaxInvoiceUpload-5376d54e.js";import{G as j}from"./GeneralFileUpload-88415f7b.js";const q={class:"add-page"},z={class:"page-header"},H=P({__name:"Add",setup(g){const A=$(),s=d(),p=d(),v=d(),f=d(!1),l=d({outboundDate:new Date,outboundNo:"",deliveryNo:"",customer:"",productSpec:"",composition:"",color:"",craft:"",fabricWeight:"",customerRemark:"",pieceCount:0,totalWeight:0,unitPrice:0,receivableAmount:0,receivedAmount:0,taxInvoiceAmount:0,remark:""}),c=d([]),n=d([]),i=d(null),R=B(()=>{const m=Number(l.value.receivableAmount||0),e=Number(l.value.receivedAmount||0);return(m-e).toFixed(2)}),C=()=>U(this,null,function*(){var m;try{f.value=!0;const e=yield F.createReceivable({outboundDate:l.value.outboundDate,outboundNo:l.value.outboundNo,customer:l.value.customer,deliveryNo:l.value.deliveryNo,productSpec:l.value.productSpec,composition:l.value.composition,color:l.value.color,craft:l.value.craft,fabricWeight:l.value.fabricWeight,customerRemark:l.value.customerRemark,pieceCount:l.value.pieceCount,totalWeight:l.value.totalWeight,unitPrice:l.value.unitPrice,receivableAmount:l.value.receivableAmount,receivedAmount:l.value.receivedAmount,taxInvoiceAmount:Number(l.value.taxInvoiceAmount||0),remark:l.value.remark,source:"manual"}),b=(e==null?void 0:e.id)||((m=e==null?void 0:e.data)==null?void 0:m.id);i.value=String(b||""),p.value&&p.value.submit(),v.value&&v.value.submit(),yield new Promise(k=>setTimeout(k,1e3)),N.success("新增成功"),A.back()}catch(e){console.error(e),N.error("保存失败")}finally{f.value=!1}});return(m,e)=>{const b=r("el-button"),k=r("el-date-picker"),u=r("el-form-item"),_=r("el-input"),x=r("el-col"),y=r("el-input-number"),I=r("el-row"),D=r("el-divider"),S=r("el-form"),W=r("el-card");return E(),T("div",q,[w("div",z,[o(b,{onClick:e[0]||(e[0]=t=>m.$router.back())},{default:a(()=>[...e[12]||(e[12]=[V("返回",-1)])]),_:1}),e[13]||(e[13]=w("h3",null,"新增应收",-1))]),o(W,null,{default:a(()=>[o(S,{model:l.value,"label-width":"100px",ref_key:"formRef",ref:s},{default:a(()=>[o(I,{gutter:24},{default:a(()=>[o(x,{span:12},{default:a(()=>[o(u,{label:"出货日期"},{default:a(()=>[o(k,{modelValue:l.value.outboundDate,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.outboundDate=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"编号"},{default:a(()=>[o(_,{modelValue:l.value.deliveryNo,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.deliveryNo=t)},null,8,["modelValue"])]),_:1}),o(u,{label:"客户"},{default:a(()=>[o(_,{modelValue:l.value.customer,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.customer=t)},null,8,["modelValue"])]),_:1}),o(u,{label:"品名规格"},{default:a(()=>[o(_,{modelValue:l.value.productSpec,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.productSpec=t)},null,8,["modelValue"])]),_:1})]),_:1}),o(x,{span:12},{default:a(()=>[o(u,{label:"应收金额"},{default:a(()=>[o(y,{modelValue:l.value.receivableAmount,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.receivableAmount=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"已收金额"},{default:a(()=>[o(y,{modelValue:l.value.receivedAmount,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.receivedAmount=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"税票金额"},{default:a(()=>[o(y,{modelValue:l.value.taxInvoiceAmount,"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.taxInvoiceAmount=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(u,{label:"未收金额"},{default:a(()=>[o(_,{value:R.value,disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(u,{label:"备注"},{default:a(()=>[o(_,{modelValue:l.value.remark,"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.remark=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),o(D,{"content-position":"left"},{default:a(()=>[...e[14]||(e[14]=[V("附件",-1)])]),_:1}),o(u,{label:"税票附件"},{default:a(()=>[o(O,{ref_key:"taxUploadRef",ref:p,modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value=t),"record-type":"receivable","record-id":i.value||"",deferred:""},null,8,["modelValue","record-id"])]),_:1}),o(u,{label:"其他附件"},{default:a(()=>[o(j,{ref_key:"otherUploadRef",ref:v,modelValue:n.value,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value=t),"record-type":"receivable","record-id":i.value||"",deferred:""},null,8,["modelValue","record-id"])]),_:1})]),_:1},8,["model"])]),_:1}),o(M,null,{button:a(()=>[o(b,{onClick:e[11]||(e[11]=t=>m.$router.back())},{default:a(()=>[...e[15]||(e[15]=[V("返回",-1)])]),_:1}),o(b,{type:"primary",onClick:C,loading:f.value},{default:a(()=>[...e[16]||(e[16]=[V("保存",-1)])]),_:1},8,["loading"])]),_:1})])}}});const Y=G(H,[["__scopeId","data-v-0a062fe9"]]);export{Y as default};
